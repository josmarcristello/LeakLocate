% This function returns classifies a single simulated test (generated by
% RTTM) in either leak, or no-leak.
% Author: Josmar Cristello
%% Inputs
%    test_path: File path for a test. Should be a matlab object with
%    pressure and velocity time-series sub-objects.
%% Outputs
%    dataset_path: Full path for the dataset folder of the project.
%% TODO
%    Include option to test both single files and multiple files (batch)
%% Main

clear;close all;clc;
% Change the current folder to the folder of this m-file.
if(~isdeployed)
  cd(fileparts(matlab.desktop.editor.getActiveFilename));
end

%% Import test file
    file_path = fullfile('F:\Onedrive\OneDrive - University of Calgary\LeakLocate\dataset\2. Simulated\batch sim 2\loc_0_relSize_1_leakStartTime_30_isLeak_1_gasMixture_CH4_Hyd_90.mat');
    [cwt_inlet, cwt_outlet] = generate_cwt(file_path, "pressure", "inlet", false);
    img_test = cwt_inlet;
    %imshow(img_test);
%% Import pre-trained CNN
    load("trained_CNN.mat");

%% Classify the image
[leak_preds,score] = classify(leak_net,cwt_inlet); 
disp(leak_preds);
disp(score);

%% Confusion Matrix
%plotconfusion(YValidation,leak_preds)